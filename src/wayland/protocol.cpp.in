// SPDX-License-Identifier: MIT
// SPDX-FileCopyrightText: 2026 Maikel Nadolski <maikel.nadolski@gmail.com>

/*
 * WARNING: This file is automatically generated from wayland.xml.
 * Any manual modifications to this file will be lost when the generator is rerun.
 * 
 * To make changes, please modify the corresponding Wayland XML protocol 
 * definition or update the generator logic itself.
 */

#include "wayland/protocol.hpp"

#include "Logging.hpp"

namespace ms::wayland {

{% for interface in interfaces %}
{{ interface.cppname }}::{{ interface.cppname }}(ObjectId objectId, ConnectionHandle connection)
: ProxyInterface(objectId, connection){% if interface.events %}, mEventQueue(connection.get_scheduler()){% endif %} {}

{{ interface.cppname }}::~{{ interface.cppname }}() = default;

{% for request in interface.requests %}
{% if request.return_type %}auto{% else %}void{% endif %}
{{ interface.cppname }}::{{ request.name }}({% for arg in request.args %}{% if arg.__tail %}, {% endif %}{{arg.type}} {{arg.name}}{% endfor %})
{% if request.return_type %}-> {{ request.return_type }}{% endif %} {
  {% if request.return_type %}auto newObjectId = this->get_connection().get_next_object_id();
  this->get_connection().send_message(this->get_object_id(), OpCode{ {{ request.num }} }, newObjectId{% for arg in request.args %}, {{ arg.name }}{% endfor %});
  return {{ request.return_type }}{newObjectId, this->get_connection()};
  {% else %}this->get_connection().send_message(this->get_object_id(), OpCode{ {{ request.num }} }{% for arg in request.args %}, {{ arg.name }}{% endfor %});
  {% endif %}
}
{% endfor %}
{% if interface.events %}
auto {{ interface.cppname }}::events() -> Observable<std::variant<{% for event in interface.events %}{% if event.__tail %}, {% endif %}{{ event.cppname }}{% endfor %}>> {
  return as_observable(this->mEventQueue);
}
{% endif %}
auto {{ interface.cppname }}::handle_message([[maybe_unused]] std::span<const char> message, OpCode code) -> IoTask<void> {
  switch (code) {
  {% for event in interface.events %}
  case OpCode{ {{ event.num }} }: {
    {{ event.cppname }} eventData;
    this->get_connection().read_message(message{% for arg in event.args %}, eventData.{{ arg.name }}{% endfor %});
    co_await this->mEventQueue.push(std::move(eventData));
    break;
  }
  {% endfor %}
  default:
    Log::w("{{ interface.cppname }}: Received unknown op code {}", static_cast<std::uint16_t>(code));
    break;
  }
  co_return;
}
{% endfor %}

} // namespace ms
