// SPDX-License-Identifier: MIT
// SPDX-FileCopyrightText: 2026 Maikel Nadolski <maikel.nadolski@gmail.com>

/*
 * WARNING: This file is automatically generated from wayland.xml.
 * Any manual modifications to this file will be lost when the generator is rerun.
 * 
 * To make changes, please modify the corresponding Wayland XML protocol 
 * definition or update the generator logic itself.
 */

#pragma once

#include "AsyncQueue.hpp"
#include "wayland/Connection.hpp"

#include <cstdint>
#include <string>
#include <string_view>
#include <variant>

namespace ms::wayland {

{% for interface in interfaces %}class {{interface.cppname}};
{% endfor %}

{% for interface in interfaces %}
class {{ interface.cppname }} : public ProxyInterface {
public:
  static constexpr auto interface_name() noexcept -> std::string_view {
    return "{{ interface.name }}";
  }

{% for entry in interface.enums %}
{% if entry.description %}/** @brief {{ entry.description }} */{% endif %}
  enum class {{ entry.cppname }} : uint32_t {
    {% for enum_value in entry.entries %}{{ enum_value.name }} = {{ enum_value.value }}{% if enum_value.__not_last %},{% endif %}{% endfor %}
  };
{% endfor %}

  {{ interface.cppname }}(ObjectId objectId, ConnectionHandle connection);
  ~{{ interface.cppname }}();

{% for event in interface.events %}
{% if event.description %}/** @brief {{ event.description }} */
{% endif %}struct {{ event.cppname }} {
  static constexpr std::size_t index = {{ event.num }};
  {% for arg in event.args %}{% if arg.description %}/** @brief {{ arg.description }} */
  {% endif %}{{ arg.type }} {{ arg.name }};
  {% endfor %}
};
{% endfor %}
{% if interface.events %}
  auto events() -> Observable<std::variant<{% for event in interface.events %}{% if event.__tail %}, {% endif %}{{ event.cppname }}{% endfor %}>>;
{% endif %}

{% for request in interface.requests %}
  {% if request.description %}/** @brief {{ request.description }} */{% endif %}
  {% if request.return_type %}auto{% else %}void{% endif %}
  {{ request.name }}({% for arg in request.args %}{% if arg.__tail %}, {% endif %}{{arg.type}} {{arg.name}}{% endfor %})
  {% if request.return_type %}-> {{ request.return_type }}{% endif %};
{% endfor %}
private:
  auto handle_message(std::span<const char> message, OpCode opCode) -> IoTask<void> override;
  auto close() -> Task<void>;
  {% if interface.events %}
  AsyncQueue<std::variant<{% for event in interface.events %}{% if event.__tail %}, {% endif %}{{ event.cppname }}{% endfor %}>> mEventQueue;{% endif %}
};
{% endfor %}

} // namespace ms
